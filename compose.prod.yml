services:
  app:
    image: kernellab-app
    entrypoint: php artisan octane:frankenphp --workers=1 --max-requests=1
    networks:
      - public
    volumes:
      - .:/app
    deploy:
      labels:
        - "traefik.enable=true"
        - "traefik.http.routers.monapp.rule=Host(`myrocket.fr`)"
        - "traefik.http.routers.monapp.entrypoints=websecure"
        - "traefik.http.services.monapp.loadbalancer.server.port=:80"
      mode: replicated
      replicas: 2
      update_config:
        order: start-first
        failure_action: rollback

volumes:
  caddy_data:
  caddy_config:
networks:
      public:
        external: true
